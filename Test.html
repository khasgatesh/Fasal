<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.7.16.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="path/to/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="./Test.css">
    
    <title>AWS</title>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark fixed-top ">
        <div class="container-fluid">
          <span class="navbar-brand mb-0 h1">Fasal Dashboard</span>
        </div>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav">
            <li class="nav-item active">
              <a class="nav-link" href="./login.html">
                <i class="fa fa-sign-out" ></i>
                Logout
                </a>
            </li>
            
          </ul>
        </div>
      </nav>
     
     <br>
     <br>
     <br>

<div class="container px-4">
    <div class="row gx-5">
      <div class="col">  
          <h4>Humidity</h4>
       <div class="p-3 border " onmouseover="scanall();" id="Humidity">
          </div>
        </div>
      <div class="col">
          <h4>Moisture</h4>
        <div class="p-3 border"  onmouseover="scanall();" id="Moisture">            
        </div>
      </div>
      <div class="col">
          <h4>Temperature</h4>
        <div class="p-3 border"  onmouseover="scanall();" id="Temperature">
                  <p></p>
        </div>
        </div>
    </div>
 </div>
 

<br>
<p class="h4">Average and Maximum Values</p>
<br>

<div class="container px-4">
    <div class="row gx-5">
      <div class="col">
        <div  style="height:200px;width:200px" id="canvas">
          
            <canvas id="hum"></canvas>
          </div>
      </div>
      <div class="col">
        <div  style="height:200px;width:200px" id="canvas">
            
            <canvas id="moist">
            
            </canvas>
           
          </div>
      </div>
      <div class="col">
        <div  style="height:200px;width:200px" id="canvas">
           
            <canvas id="temp"></canvas>
          </div>
        </div>
    </div>
 </div>
<br>

<p class="h4">Distribution of Sensor Values</p>
<br>
 <div class="container px-4">
  <div class="row gx-5">
    <div class="col">
      <div  style="height:200px;width:200px" id="canvas">
         
          <canvas id="Hum"></canvas>
        </div>
    </div>
    <div class="col">
      <div  style="height:200px;width:200px" id="canvas">
        
          <canvas id="Moist">
          
          </canvas>
         
        </div>
    </div>
    <div class="col">
      <div  style="height:200px;width:200px" id="canvas">
       
          <canvas id="Temp"></canvas>
        </div>
      </div>
  </div>
</div>
<br>


 <div class="footer">
    <p>Copyright&copy at Fasal </p>
  </div>
  <script>
    AWS.config.update({
      "region": "us-east-2",
      "endpoint": "https://dynamodb.us-east-2.amazonaws.com",
      "accessKeyId": "AKIAZ7JJJKGEBF52EU66",
      "secretAccessKey": "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"
    });
    var docClient = new AWS.DynamoDB.DocumentClient();



    function scanall() {
      var params = {
        TableName: "nodemcu2db"
      };
      docClient.scan(params, (err, data) => {
        if (err) {
          console.log("Unreached" + JSON.stringify(err, undefined, 2))
        } else {

         


          var container = document.getElementById('table')

          var x = []
          var y = []
          var z = []
          var time=[]
          for (var i = 0; i < data.Items.length; i++) {
            // console.log(parseInt(data.Items[i].Tmpr.Humidity))
            //console.log(parseInt(data.Items[i].Tmpr.Moisture))
            time.push(data.Items[i].Time)
            x.push(parseInt(data.Items[i].Tmpr.Humidity))
            y.push(parseInt(data.Items[i].Tmpr.Moisture))
            z.push(parseInt(data.Items[i].Tmpr.Temperature))
            
            //  var div=document.createElement("div");
            //  var br=document.createElement("br")
            //  div.innerHTML=JSON.stringify(data.Items[i],2)
            // container.appendChild(br)
            // container.appendChild(div)
          }
          var last_10_humidity=x.slice(-10)
          var last_10_moisture=y.slice(-10)
          var last_10_Temp=z.slice(-10)

          var last_10_time=time.slice(-10)
          var sum = x => x.reduce((a, b) => a + b, 0); // summation function

          var Humidity = sum(x)
          var Average = Humidity / x.length
          document.getElementById('Humidity').innerHTML = Average.toFixed(1)

          var Moisture = sum(y)
          var Average_Moist = Moisture / y.length
          document.getElementById('Moisture').innerHTML = Average_Moist.toFixed(1)

          var Temperature = sum(z)
          // console.log(Temperature)
          var Average_Temp = Temperature / z.length

          document.getElementById('Temperature').innerHTML = Average_Temp.toFixed(2)

           var High_temperature=Math.max(...z)
           var High_humidity=Math.max(...x)
           var high_moist=Math.max(...y)

      
             var H_guage=document.getElementById('hum').getContext('2d')
             var M_guage=document.getElementById('moist').getContext('2d')
             var T_guage=document.getElementById('temp').getContext('2d')

            
          let hum_guage=new Chart(H_guage,{
            type:'doughnut',
            data:{
              labels: ['Average','Max'],
              datasets: [{
                label: 'Soil Contents',
                data: [
                  Average,High_humidity
                ],
                //backgroundColor:'green',
                backgroundColor: [
                  'rgba(255, 99, 132, 0.6)',
                  'rgba(54, 162, 235, 0.6)',
                  'rgba(255, 206, 86, 0.6)',
                  'rgba(75, 192, 192, 0.6)',
                  'rgba(153, 102, 255, 0.6)',
                  'rgba(255, 159, 64, 0.6)',
                  'rgba(255, 99, 132, 0.6)'
                ],
                borderWidth: 1,
                borderColor: '#777',
                hoverBorderWidth: 3,
                hoverBorderColor: '#000'
              }]
            },
            options:{
              circumference: 180,
              rotation:-90,
              cutout:50
            },
            plugins: {
      datalabels: {
        display: true,
        align: 'bottom',
        backgroundColor: '#ccc',
        borderRadius: 3,
        font: {
          size: 18,
        }
      },
    }
            
 })
          let moist_guage=new Chart(M_guage,{
            type:'doughnut',
            data:{
              labels: ['Avarage','Max'],
              datasets: [{
                label: ['Max','Min'],
                data: [
                  Average_Moist,high_moist
                ],
                //backgroundColor:'green',
                backgroundColor: [
                  'rgba(255, 99, 132, 0.6)',
                  'rgba(54, 162, 235, 0.6)',
                  'rgba(255, 206, 86, 0.6)',
                  'rgba(75, 192, 192, 0.6)',
                  'rgba(153, 102, 255, 0.6)',
                  'rgba(255, 159, 64, 0.6)',
                  'rgba(255, 99, 132, 0.6)'
                ],
                borderWidth: 1,
                borderColor: '#777',
                hoverBorderWidth: 3,
                hoverBorderColor: '#000'
              }]
            },
            options:{
              circumference: 180,
              rotation:-90,
              cutout:50
            },
            plugins: {
      datalabels: {
        color: 'blue',
        labels: {
          title: {
            font: {
              weight: 'bold'
            }
          },
          value: {
            color: 'green'
          }
        }
      }
    }
          })
          let temp_guage=new Chart(T_guage,{
            type:'doughnut',
            data:{
              labels: ['Average','Max'],
              datasets: [{
                label: 'Soil Contents',
                data: [
                  Average_Temp,High_temperature
                ],
                //backgroundColor:'green',
                backgroundColor: [
                  'rgba(255, 99, 132, 0.6)',
                  'rgba(54, 162, 235, 0.6)',
                  'rgba(255, 206, 86, 0.6)',
                  'rgba(75, 192, 192, 0.6)',
                  'rgba(153, 102, 255, 0.6)',
                  'rgba(255, 159, 64, 0.6)',
                  'rgba(255, 99, 132, 0.6)'
                ],
                borderWidth: 1,
                borderColor: '#777',
                hoverBorderWidth: 3,
                hoverBorderColor: '#000'
              }]
            },
            options:{
              circumference: 180,
              rotation:-90,
              cutout:50
            }
          })


          var Hum_line=document.getElementById('Hum').getContext('2d')
          var Moist_line=document.getElementById('Moist').getContext('2d')
          var Temp_line=document.getElementById('Temp')

          let Hum_chart=new Chart(Hum_line,{
            type:'line',
            data:{
              labels: last_10_time,
              datasets: [{
                label:'Humidity',
                data: 
                  last_10_humidity
                ,
                tension:0.6,
                //backgroundColor:'green',
                backgroundColor: [
                  'rgba(255, 99, 132, 0.6)',
                  
                ],
                borderWidth: 1,
                borderColor: '#777',
                hoverBorderWidth: 3,
                hoverBorderColor: '#000'
              }]
            },
            options:{
              circumference: 180,
              rotation:-90,
              cutout:50
            }
          })

          let Moist_chart=new Chart(Moist_line,{
            type:'line',
            data:{
              labels: last_10_time,
              datasets: [{
                label:'Moisture',
                data: 
                  last_10_moisture
                ,
                tension:0.6,
                //backgroundColor:'green',
                backgroundColor: [
                  'rgba(255, 99, 132, 0.6)',
                  
                ],
                borderWidth: 1,
                borderColor: '#777',
                hoverBorderWidth: 3,
                hoverBorderColor: '#000'
              }]
            },
            options:{
              circumference: 180,
              rotation:-90,
              cutout:50
            }
          })
         
          let Temp_chart=new Chart(Temp_line,{
            type:'line',
            data:{
              labels: last_10_time,
              datasets: [{
                label:'Temperature',
                data: 
                  last_10_Temp
                ,
                tension:0.2,
                //backgroundColor:'green',
                backgroundColor: [
                  'rgba(255, 99, 132, 0.6)',
                  
                ],
                borderWidth: 1,
                borderColor: '#777',
                hoverBorderWidth: 3,
                hoverBorderColor: '#000'
              }]
            },
            options:{
              circumference: 180,
              rotation:-90,
              cutout:50
            }
          })

        
        }
      });
    }
  </script>

 
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
</body>
</html>